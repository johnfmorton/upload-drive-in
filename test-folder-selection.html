<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Folder Selection Auto-Save</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 100%; }
        button { padding: 8px 16px; margin: 4px; border: 1px solid #ccc; border-radius: 4px; cursor: pointer; }
        .primary { background: #3b82f6; color: white; }
        .secondary { background: #6b7280; color: white; }
        .folder-item { padding: 8px; border-bottom: 1px solid #eee; cursor: pointer; }
        .folder-item:hover { background: #f3f4f6; }
        .info { background: #dbeafe; padding: 12px; border-radius: 4px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Test Google Drive Folder Selection Auto-Save</h1>
    
    <div x-data="testGoogleDriveFolderPicker()" x-init="init()">
        <form id="test-form" @submit.prevent="handleFormSubmit">
            <input type="hidden" name="google_drive_root_folder_id" x-model="currentFolderId" />
            
            <div class="info">
                <strong>Current Folder:</strong> 
                <span x-text="currentFolderName || 'Google Drive Root (default)'"></span>
            </div>
            
            <button type="button" @click="openModal" class="primary">
                Select Folder
            </button>
            
            <div class="info">
                <p>üí° Your folder selection is automatically saved when you click "Confirm" in the folder picker.</p>
            </div>
        </form>

        <!-- Modal -->
        <div x-show="showModal" x-cloak class="modal">
            <div class="modal-content">
                <h2>Select Folder</h2>
                
                <div style="margin: 10px 0;">
                    <strong>Current Path:</strong> 
                    <span x-text="folderStack.length ? folderStack[folderStack.length - 1].name : 'Google Drive Root'"></span>
                </div>
                
                <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ccc; margin: 10px 0;">
                    <template x-for="folder in folders" :key="folder.id">
                        <div class="folder-item" @click="enterFolder(folder)">
                            üìÅ <span x-text="folder.name"></span>
                        </div>
                    </template>
                    <template x-if="folders.length === 0">
                        <div class="folder-item">No folders found</div>
                    </template>
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                    <button type="button" @click="useGoogleDriveRoot" class="secondary">
                        Use Google Drive Root (default)
                    </button>
                    <div>
                        <button type="button" @click="confirmSelection" class="primary">Confirm</button>
                        <button type="button" @click="closeModal" class="secondary">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Display -->
        <div style="margin-top: 20px; padding: 10px; background: #f9fafb; border-radius: 4px;">
            <h3>Test Status:</h3>
            <div x-show="lastAction">
                <strong>Last Action:</strong> <span x-text="lastAction"></span>
            </div>
            <div x-show="formSubmitted">
                <strong>Form Submitted:</strong> Yes (auto-save triggered)
            </div>
        </div>
    </div>

    <script>
        function testGoogleDriveFolderPicker() {
            return {
                showModal: false,
                currentFolderId: '',
                currentFolderName: '',
                folderStack: [],
                folders: [
                    { id: 'folder1', name: 'Documents' },
                    { id: 'folder2', name: 'Images' },
                    { id: 'folder3', name: 'Projects' }
                ],
                lastAction: '',
                formSubmitted: false,
                
                init() {
                    this.folderStack = [{ id: 'root', name: 'Google Drive Root' }];
                },
                
                openModal() {
                    this.showModal = true;
                    this.lastAction = 'Opened folder selection modal';
                },
                
                closeModal() {
                    this.showModal = false;
                    this.lastAction = 'Closed modal without selection';
                },
                
                enterFolder(folder) {
                    this.folderStack.push(folder);
                    this.lastAction = `Entered folder: ${folder.name}`;
                    // In real implementation, this would load subfolders
                },
                
                confirmSelection() {
                    const selected = this.folderStack[this.folderStack.length - 1];
                    
                    if (selected.id === 'root') {
                        this.currentFolderId = '';
                        this.currentFolderName = '';
                    } else {
                        this.currentFolderId = selected.id;
                        this.currentFolderName = selected.name;
                    }
                    
                    this.showModal = false;
                    this.lastAction = `Confirmed selection: ${selected.name}`;
                    
                    // Auto-save the selection to the database
                    this.saveFolder();
                },
                
                useGoogleDriveRoot() {
                    this.currentFolderId = '';
                    this.currentFolderName = '';
                    this.showModal = false;
                    this.lastAction = 'Selected Google Drive Root (default)';
                    
                    // Auto-save the selection to the database
                    this.saveFolder();
                },
                
                saveFolder() {
                    // Submit the form to save the folder selection
                    this.lastAction += ' ‚Üí Auto-saving...';
                    const form = this.$el.querySelector('form');
                    if (form) {
                        form.submit();
                    } else {
                        console.error('Form not found for auto-save');
                        this.lastAction += ' ‚Üí ERROR: Form not found!';
                    }
                },
                
                handleFormSubmit() {
                    this.formSubmitted = true;
                    this.lastAction += ' ‚Üí Form submitted successfully!';
                    console.log('Form would be submitted with folder ID:', this.currentFolderId);
                }
            };
        }
    </script>
</body>
</html>