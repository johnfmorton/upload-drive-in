var p=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var y=p((b,h)=>{class f{constructor(e={}){this.baseInterval=e.baseInterval||1e3,this.maxInterval=e.maxInterval||3e4,this.backoffMultiplier=e.backoffMultiplier||1.5,this.maxRetries=e.maxRetries||5,this.intervalsByStatus={testing:1e3,completed:3e4,failed:5e3,timeout:1e4,not_tested:6e4},this.requestTimeout=e.requestTimeout||15e3,this.abortController=null,this.currentInterval=this.baseInterval,this.retryCount=0,this.isPolling=!1,this.pollTimeoutId=null,this.lastPollTime=0,this.consecutiveErrors=0,this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,responseTimes:[],lastError:null,startTime:Date.now()},this.onStatusUpdate=e.onStatusUpdate||(()=>{}),this.onError=e.onError||(()=>{}),this.onMetricsUpdate=e.onMetricsUpdate||(()=>{}),this.poll=this.poll.bind(this),this.handleResponse=this.handleResponse.bind(this),this.handleError=this.handleError.bind(this)}startPolling(e,t={}){this.isPolling&&(console.log("Polling already in progress, stopping previous poll"),this.stopPolling()),this.jobId=e,this.isPolling=!0,this.retryCount=0,this.consecutiveErrors=0,this.currentInterval=this.baseInterval,t.intervals&&(this.intervalsByStatus={...this.intervalsByStatus,...t.intervals}),console.log("Starting queue worker polling",{jobId:this.jobId,baseInterval:this.baseInterval,maxInterval:this.maxInterval}),this.poll()}stopPolling(){this.isPolling&&(console.log("Stopping queue worker polling",{jobId:this.jobId,totalRequests:this.metrics.totalRequests,duration:Date.now()-this.metrics.startTime}),this.isPolling=!1,this.pollTimeoutId&&(clearTimeout(this.pollTimeoutId),this.pollTimeoutId=null),this.abortController&&(this.abortController.abort(),this.abortController=null),this.jobId=null,this.retryCount=0,this.consecutiveErrors=0,this.currentInterval=this.baseInterval)}async poll(){if(!this.isPolling||!this.jobId)return;const e=performance.now();this.lastPollTime=Date.now(),this.metrics.totalRequests++;try{this.abortController=new AbortController;const t=setTimeout(()=>{this.abortController&&this.abortController.abort()},this.requestTimeout),s=await fetch(`/setup/queue-worker/status/${this.jobId}`,{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"application/json","X-CSRF-TOKEN":this.getCSRFToken()},signal:this.abortController.signal});if(clearTimeout(t),!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const r=await s.json(),i=performance.now()-e;this.handleResponse(r,i)}catch(t){const s=performance.now()-e;this.handleError(t,s)}finally{this.abortController=null}}handleResponse(e,t){this.metrics.successfulRequests++,this.updateResponseTimeMetrics(t),this.consecutiveErrors=0,this.retryCount=0,console.log("Poll response received",{jobId:this.jobId,status:e.status,responseTime:Math.round(t),consecutiveErrors:this.consecutiveErrors}),this.onStatusUpdate(e);const s=this.shouldContinuePolling(e);if(s&&this.isPolling){const r=this.calculateNextInterval(e.status);this.scheduleNextPoll(r)}else console.log("Stopping polling based on status",{status:e.status,shouldContinue:s,isPolling:this.isPolling}),this.stopPolling();this.onMetricsUpdate(this.getMetrics())}handleError(e,t){if(this.metrics.failedRequests++,this.metrics.lastError={message:e.message,timestamp:new Date().toISOString(),responseTime:Math.round(t)},this.consecutiveErrors++,this.retryCount++,console.error("Poll request failed",{jobId:this.jobId,error:e.message,retryCount:this.retryCount,consecutiveErrors:this.consecutiveErrors,responseTime:Math.round(t)}),this.onError(e,this.retryCount),this.retryCount<this.maxRetries&&this.isPolling){const s=this.calculateBackoffInterval();console.log("Scheduling retry with backoff",{retryCount:this.retryCount,backoffInterval:s,maxRetries:this.maxRetries}),this.scheduleNextPoll(s)}else console.error("Max retries reached or polling stopped",{retryCount:this.retryCount,maxRetries:this.maxRetries,isPolling:this.isPolling}),this.stopPolling();this.onMetricsUpdate(this.getMetrics())}calculateNextInterval(e){return this.intervalsByStatus[e]?this.intervalsByStatus[e]:this.baseInterval}calculateBackoffInterval(){const e=Math.min(this.baseInterval*Math.pow(this.backoffMultiplier,this.retryCount-1),this.maxInterval),t=Math.random()*.1*e;return Math.round(e+t)}scheduleNextPoll(e){this.isPolling&&(this.currentInterval=e,this.pollTimeoutId=setTimeout(()=>{this.isPolling&&this.poll()},e),console.log("Next poll scheduled",{interval:e,jobId:this.jobId,retryCount:this.retryCount}))}shouldContinuePolling(e){return!["completed","failed","timeout","error"].includes(e.status)}updateResponseTimeMetrics(e){this.metrics.responseTimes.push(e),this.metrics.responseTimes.length>100&&this.metrics.responseTimes.shift(),this.metrics.averageResponseTime=this.metrics.responseTimes.reduce((t,s)=>t+s,0)/this.metrics.responseTimes.length}getMetrics(){const t=Date.now()-this.metrics.startTime;return{...this.metrics,duration:t,requestsPerSecond:this.metrics.totalRequests/(t/1e3),successRate:this.metrics.totalRequests>0?this.metrics.successfulRequests/this.metrics.totalRequests*100:0,currentInterval:this.currentInterval,isPolling:this.isPolling,consecutiveErrors:this.consecutiveErrors,retryCount:this.retryCount}}getCSRFToken(){var t;const e=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");return e||console.warn("CSRF token not found"),e||""}resetMetrics(){this.metrics={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,responseTimes:[],lastError:null,startTime:Date.now()}}getStatus(){return{isPolling:this.isPolling,jobId:this.jobId,currentInterval:this.currentInterval,retryCount:this.retryCount,consecutiveErrors:this.consecutiveErrors,lastPollTime:this.lastPollTime,metrics:this.getMetrics()}}}class m{constructor(e={}){this.generalStatusSteps=["database","mail","cloud_storage","migrations","admin_user"],this.statusSteps=["database","mail","cloud_storage","migrations","admin_user","queue_worker"],this.refreshInProgress=!1,this.queueWorkerTestInProgress=!1,this.emailTestInProgress=!1,this.retryAttempts=0,this.maxRetryAttempts=3,this.retryDelay=2e3,this.autoRefreshInterval=null,this.autoRefreshEnabled=!1,this.autoInit=e.autoInit!==!1,this.lastRefreshTime=0,this.lastQueueTestTime=0,this.lastEmailTestTime=0,this.debounceDelay=1e3,this.clickTimeouts=new Map,this.pollingService=new f({baseInterval:1e3,maxInterval:3e4,requestTimeout:15e3,onStatusUpdate:this.handlePollingStatusUpdate.bind(this),onError:this.handlePollingError.bind(this),onMetricsUpdate:this.handlePollingMetrics.bind(this)}),this.refreshAllStatuses=this.refreshAllStatuses.bind(this),this.refreshGeneralStatuses=this.refreshGeneralStatuses.bind(this),this.refreshSingleStep=this.refreshSingleStep.bind(this),this.handleRefreshError=this.handleRefreshError.bind(this),this.retryRefresh=this.retryRefresh.bind(this),this.getCachedQueueWorkerStatus=this.getCachedQueueWorkerStatus.bind(this),this.triggerQueueWorkerTest=this.triggerQueueWorkerTest.bind(this),this.testEmail=this.testEmail.bind(this),this.autoInit&&this.init()}init(){this.setupCSRFToken(),this.bindEventListeners(),this.setupKeyboardNavigation(),this.loadCachedQueueWorkerStatus()}setupCSRFToken(){var e;if(!document.querySelector('meta[name="csrf-token"]')){const t=document.createElement("meta");t.name="csrf-token",t.content=((e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.getAttribute("content"))||"",document.head.appendChild(t)}}bindEventListeners(){const e=document.getElementById("refresh-status-btn");e&&e.addEventListener("click",o=>{this.debouncedRefreshAllStatuses(o)}),this.statusSteps.forEach(o=>{const n=document.getElementById(`refresh-${o}-btn`);n&&n.addEventListener("click",()=>{o==="queue_worker"?this.triggerQueueWorkerTest():this.refreshSingleStep(o)})});const t=document.getElementById("auto-refresh-toggle");t&&t.addEventListener("change",o=>{this.toggleAutoRefresh(o.target.checked)}),document.addEventListener("click",o=>{o.target.classList.contains("retry-refresh-btn")&&this.retryRefresh()});const s=document.getElementById("test-queue-worker-btn");s&&s.addEventListener("click",o=>{this.debouncedTestQueueWorker(o)});const r=document.getElementById("test-email-btn");r&&r.addEventListener("click",o=>{this.debouncedTestEmail(o)});const i=document.getElementById("test-email-address");i&&i.addEventListener("keypress",o=>{o.key==="Enter"&&(o.preventDefault(),this.debouncedTestEmail(o))})}setupKeyboardNavigation(){document.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="r"&&!this.refreshInProgress&&(e.preventDefault(),this.refreshAllStatuses())})}getCSRFToken(){var t;const e=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content");return e||console.warn("CSRF token not found"),e}debouncedRefreshAllStatuses(e){e.preventDefault();const t=Date.now(),s=t-this.lastRefreshTime;if(this.refreshInProgress||this.queueWorkerTestInProgress){console.log("Operation already in progress, ignoring click");return}if(s<this.debounceDelay){console.log("Debouncing refresh request"),this.clickTimeouts.has("refresh")&&clearTimeout(this.clickTimeouts.get("refresh"));const r=setTimeout(()=>{this.refreshAllStatuses(),this.clickTimeouts.delete("refresh")},this.debounceDelay-s);this.clickTimeouts.set("refresh",r);return}this.lastRefreshTime=t,this.refreshAllStatuses()}debouncedTestQueueWorker(e){e.preventDefault();const t=Date.now(),s=t-this.lastQueueTestTime;if(this.queueWorkerTestInProgress||this.refreshInProgress){console.log("Operation already in progress, ignoring click");return}if(s<this.debounceDelay){console.log("Debouncing queue test request"),this.clickTimeouts.has("queueTest")&&clearTimeout(this.clickTimeouts.get("queueTest"));const r=setTimeout(()=>{this.testQueueWorker(),this.clickTimeouts.delete("queueTest")},this.debounceDelay-s);this.clickTimeouts.set("queueTest",r);return}this.lastQueueTestTime=t,this.testQueueWorker()}debouncedRetryQueueWorkerTest(e){e.preventDefault();const t=Date.now(),s=t-this.lastQueueTestTime;if(this.queueWorkerTestInProgress||this.refreshInProgress){console.log("Operation already in progress, ignoring click");return}if(s<this.debounceDelay){console.log("Debouncing retry request"),this.clickTimeouts.has("retry")&&clearTimeout(this.clickTimeouts.get("retry"));const r=setTimeout(()=>{this.retryQueueWorkerTest(),this.clickTimeouts.delete("retry")},this.debounceDelay-s);this.clickTimeouts.set("retry",r);return}this.lastQueueTestTime=t,this.retryQueueWorkerTest()}async refreshAllStatuses(){if(this.refreshInProgress){console.log("Refresh already in progress, skipping...");return}try{this.setLoadingState(!0),this.clearErrorMessages();const[e,t]=await Promise.allSettled([this.refreshGeneralStatuses(),this.triggerQueueWorkerTest()]);e.status==="fulfilled"?(this.updateLastChecked(),this.resetRetryAttempts()):(console.error("General status refresh failed:",e.reason),this.handleRefreshError(e.reason,"general")),t.status==="rejected"&&console.error("Queue worker test failed:",t.reason),e.status==="fulfilled"&&this.showSuccessMessage("Status refreshed successfully")}catch(e){console.error("Error refreshing all statuses:",e),this.handleRefreshError(e,"all")}finally{this.setLoadingState(!1),this.queueWorkerTestInProgress||this.setQueueWorkerTestButtonState(!1)}}async refreshGeneralStatuses(){var t;const e=await this.makeAjaxRequest("/setup/status/refresh",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"}});if(!e.success)throw new Error(((t=e.error)==null?void 0:t.message)||"Failed to refresh status");return this.updateGeneralStepStatuses(e.data.statuses),e}async refreshSingleStep(e){var t;if(this.refreshInProgress){console.log("Refresh already in progress, skipping...");return}if(!this.statusSteps.includes(e)){console.error("Invalid step name:",e);return}try{this.setSingleStepLoadingState(e,!0);const s=await this.makeAjaxRequest("/setup/status/refresh-step",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({step:e})});if(!s.success)throw new Error(((t=s.error)==null?void 0:t.message)||`Failed to refresh ${e} status`);const r=s.data.status.details,i=typeof r=="object"?JSON.stringify(r):r||s.data.status.message;this.updateStatusIndicator(e,s.data.status.status,s.data.status.message,i),this.updateLastChecked(),this.showSuccessMessage(`${s.data.status.step_name} status refreshed`)}catch(s){console.error(`Error refreshing ${e} status:`,s),this.handleRefreshError(s,e)}finally{this.setSingleStepLoadingState(e,!1)}}async makeAjaxRequest(e,t={}){var i;const s=new AbortController,r=setTimeout(()=>s.abort(),3e4);try{const o=await fetch(e,{...t,signal:s.signal});if(clearTimeout(r),!o.ok){const n=await o.json().catch(()=>({}));throw new Error(((i=n.error)==null?void 0:i.message)||`HTTP ${o.status}: ${o.statusText}`)}return await o.json()}catch(o){throw clearTimeout(r),o.name==="AbortError"?new Error("Request timed out. Please check your connection and try again."):o}}updateAllStepStatuses(e){this.statusSteps.forEach(t=>{if(e&&e[t]){const s=e[t],r=s.details,i=typeof r=="object"?JSON.stringify(r):r||s.message;this.updateStatusIndicator(t,s.status,s.message,i)}else console.warn(`No status data found for step: ${t}`),this.updateStatusIndicator(t,"error","No Data","Status information not available")})}updateGeneralStepStatuses(e){this.generalStatusSteps.forEach(t=>{if(e&&e[t]){const s=e[t],r=s.details,i=typeof r=="object"?JSON.stringify(r):r||s.message;this.updateStatusIndicator(t,s.status,s.message,i)}else console.warn(`No status data found for step: ${t}`),this.updateStatusIndicator(t,"error","No Data","Status information not available")})}updateStatusIndicator(e,t,s,r=null){const i=document.getElementById(`status-${e}`),o=document.getElementById(`status-${e}-text`),n=document.getElementById(`details-${e}-text`);if(!i||!o){console.error(`Could not find status elements for step: ${e}`);return}const l=["status-completed","status-working","status-idle","status-incomplete","status-error","status-checking","status-cannot-verify","status-needs_attention"];if(i.classList.remove(...l),i.classList.add(`status-${t}`),this.animateTextChange(o,s),this.updateStatusIcon(i,t),n&&r){let a=r;typeof r=="object"&&r!==null&&(r.message?a=r.message:r.error_message?a=r.error_message:a=JSON.stringify(r)),this.updateStatusDetails(e,t,a)}i.setAttribute("aria-label",`${e} status: ${s}`)}updateStatusIcon(e,t){console.log(`SetupStatusManager: Updating icon for status: ${t}`);let s=e.querySelector("svg"),r=!1;if(s||(s=e.querySelector(".status-emoji"),r=!0,console.log("SetupStatusManager: Found emoji icon element")),!s){console.log("SetupStatusManager: Creating new emoji icon element"),s=document.createElement("span"),s.className="status-emoji w-4 h-4 mr-1.5 text-base";const n=e.querySelector("span");n?e.insertBefore(s,n):e.appendChild(s),r=!0}const i={completed:"âœ…",working:"âœ…",idle:"âœ…",incomplete:"âŒ",error:"ðŸš«",failed:"ðŸš«",timeout:"â°","cannot-verify":"â“",needs_attention:"âš ï¸",checking:"ðŸ”„",not_tested:"â“"},o=i[t]||i.checking;if(console.log(`SetupStatusManager: Setting emoji to: ${o}`),r)s.textContent=o;else{const n=document.createElement("span");n.className="status-emoji w-4 h-4 mr-1.5 text-base",n.textContent=o,s.parentNode.replaceChild(n,s)}}animateTextChange(e,t){e.style.opacity="0.5",setTimeout(()=>{e.textContent=t,e.style.opacity="1"},150)}setLoadingState(e){this.refreshInProgress=e,this.setRefreshButtonState(e),this.setQueueWorkerTestButtonState(this.queueWorkerTestInProgress||e),e&&this.generalStatusSteps.forEach(t=>{this.updateStatusIndicator(t,"checking","Checking...","Verifying configuration...")})}setRefreshButtonState(e){const t=document.getElementById("refresh-status-btn"),s=document.getElementById("refresh-btn-text"),r=document.getElementById("refresh-spinner");t&&s&&r&&(t.disabled=e||this.queueWorkerTestInProgress,s.textContent=e?"Checking...":"Check Status",e?(r.classList.remove("hidden"),t.classList.add("cursor-not-allowed","opacity-75")):(r.classList.add("hidden"),t.classList.remove("cursor-not-allowed","opacity-75")),t.disabled?(t.setAttribute("aria-disabled","true"),t.setAttribute("title","Please wait for current operation to complete")):(t.removeAttribute("aria-disabled"),t.setAttribute("title","Check all setup statuses")))}setSingleStepLoadingState(e,t){t&&this.updateStatusIndicator(e,"checking","Checking...","Verifying configuration...")}handleRefreshError(e,t="all"){this.retryAttempts++,console.error(`Refresh error (attempt ${this.retryAttempts}):`,e),this.retryAttempts<this.maxRetryAttempts?(this.showRetryMessage(e.message,t),setTimeout(()=>{t==="all"?this.refreshAllStatuses():this.refreshSingleStep(t)},this.retryDelay*this.retryAttempts)):(this.showErrorState(e.message,t),this.resetRetryAttempts())}showRetryMessage(e,t){const s=`Failed to refresh status (${e}). Retrying in ${this.retryDelay*this.retryAttempts/1e3} seconds... (Attempt ${this.retryAttempts}/${this.maxRetryAttempts})`;this.showMessage(s,"warning")}showErrorState(e,t){t==="all"?this.statusSteps.forEach(s=>{this.updateStatusIndicator(s,"error","Check Failed","Unable to verify status. Please check your connection and try again.")}):this.updateStatusIndicator(t,"error","Check Failed","Unable to verify status. Please check your connection and try again."),this.showMessage(`Failed to refresh status: ${e}. Please check your connection and try again.`,"error",!0)}showMessage(e,t="info",s=!1){console.log(`${t.toUpperCase()}: ${e}`),t==="error"||s?(alert(`${t.toUpperCase()}: ${e}`),s&&confirm("Would you like to retry now?")&&this.retryRefresh()):t==="success"&&console.log(`SUCCESS: ${e}`)}hideRetryButton(){const e=document.querySelector(".retry-queue-test-btn");e&&e.remove()}handlePollingStatusUpdate(e){console.log("Polling status update received",e),e.status&&e.message&&this.updateQueueWorkerStatus(e.status,e.message,e.details),["completed","failed","timeout","error"].includes(e.status)&&(this.queueWorkerTestInProgress=!1,this.setQueueWorkerTestButtonState(!1),e.status==="completed"?this.showSuccessMessage("Queue worker test completed successfully"):this.showQueueWorkerErrorDetails(e))}handlePollingError(e,t){console.error("Polling error occurred",{error:e.message,retryCount:t}),t>=this.pollingService.maxRetries&&(this.queueWorkerTestInProgress=!1,this.setQueueWorkerTestButtonState(!1),this.updateQueueWorkerStatus("error","Failed to check queue worker status",`Network error: ${e.message}`),this.showErrorMessage(`Queue worker test failed: ${e.message}. Please check your connection and try again.`))}handlePollingMetrics(e){e.averageResponseTime>2e3&&console.warn("Slow polling performance detected",{averageResponseTime:Math.round(e.averageResponseTime),successRate:Math.round(e.successRate),totalRequests:e.totalRequests}),this.updatePerformanceIndicators(e)}updatePerformanceIndicators(e){e.successRate<80&&e.totalRequests>5&&console.warn("Low success rate detected in queue worker polling",{successRate:Math.round(e.successRate),totalRequests:e.totalRequests,consecutiveErrors:e.consecutiveErrors})}showQueueWorkerErrorDetails(e){const t=document.getElementById("queue-test-error-details"),s=document.getElementById("queue-test-error-message"),r=document.getElementById("queue-test-troubleshooting-content");t&&s&&(s.textContent=e.error_message||"Test failed with unknown error",r&&e.troubleshooting&&Array.isArray(e.troubleshooting)&&(r.innerHTML="",e.troubleshooting.forEach(i=>{const o=document.createElement("div");o.className="text-xs text-red-600 mb-1",o.innerHTML=`â€¢ ${this.escapeHtml(i)}`,r.appendChild(o)})),t.classList.remove("hidden"))}hideQueueWorkerErrorDetails(){const e=document.getElementById("queue-test-error-details");e&&e.classList.add("hidden")}showQueueWorkerSuccessDetails(e){const t=document.getElementById("queue-test-success-details"),s=document.getElementById("queue-test-success-message"),r=document.getElementById("queue-test-processing-time");t&&s&&(s.textContent=e.message||"Queue worker is functioning properly",r&&e.processing_time&&(r.textContent=`Processing time: ${e.processing_time.toFixed(2)} seconds`),t.classList.remove("hidden"))}hideQueueWorkerSuccessDetails(){const e=document.getElementById("queue-test-success-details");e&&e.classList.add("hidden")}showQueueWorkerProgressDetails(e){const t=document.getElementById("queue-test-progress"),s=document.getElementById("queue-test-progress-text");t&&s&&(s.textContent=e.message||"Testing queue worker...",t.classList.remove("hidden"))}hideQueueWorkerProgressDetails(){const e=document.getElementById("queue-test-progress");e&&e.classList.add("hidden")}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}getTroubleshootingSteps(e){const t={dispatch_failed:["Verify queue configuration in .env file (QUEUE_CONNECTION)","Check if database tables exist: php artisan migrate","Ensure queue driver is properly configured (database, redis, etc.)","Check application logs for configuration errors","Verify file permissions for storage and cache directories","Test database connection: php artisan tinker, then DB::connection()->getPdo()","For Redis queue: ensure Redis server is running and accessible"],timeout:["Ensure queue worker is running: php artisan queue:work","Check if worker process is stuck or crashed","Verify queue driver configuration (database, redis, etc.)","Check system resources (CPU, memory, disk space)","Review worker logs for errors or warnings","Restart the queue worker: php artisan queue:restart","Check for long-running jobs blocking the queue"],network_error:["Check your internet connection","Verify the application server is accessible","Check for firewall or proxy issues","Try refreshing the page and testing again","Contact your network administrator if issues persist"],general:["Check if queue worker is running: php artisan queue:work","Verify queue configuration in .env file","Check for failed jobs: php artisan queue:failed","Review application logs for errors","Restart the queue worker if needed","Check system resources and permissions"]};return t[e]||t.general}clearAllTimeouts(){this.clickTimeouts.forEach(e=>{clearTimeout(e)}),this.clickTimeouts.clear()}getIconName(e){const t={success:"check-circle",error:"exclamation-triangle",warning:"exclamation-triangle",info:"info-circle"};return t[e]||t.info}showSuccessMessage(e){this.showMessage(e,"success")}showErrorMessage(e,t=!1){this.showMessage(e,"error",t)}clearMessages(){console.log("Clearing messages...")}clearErrorMessages(){console.log("Clearing error messages...")}async loadCachedQueueWorkerStatus(){try{const e=await this.getCachedQueueWorkerStatus();e&&!this.isStatusExpired(e)?this.updateQueueWorkerStatusFromCache(e):this.updateStatusIndicator("queue_worker","not_tested","Click the Test Queue Worker button below","No recent test results available")}catch(e){console.error("Error loading cached queue worker status:",e),this.updateStatusIndicator("queue_worker","not_tested","Click the Test Queue Worker button below","Unable to load cached status")}}async getCachedQueueWorkerStatus(){try{const e=await this.makeAjaxRequest("/setup/queue-worker/status",{method:"GET",headers:{"X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"}});return e.success&&e.data&&e.data.queue_worker?e.data.queue_worker:null}catch(e){return console.error("Error fetching cached queue worker status:",e),null}}isStatusExpired(e){if(!e.test_completed_at)return!0;const t=new Date(e.test_completed_at),s=new Date,r=3600*1e3;return s-t>r}updateQueueWorkerStatusFromCache(e){let t,s,r;switch(e.status){case"completed":t="completed",s="Queue worker is functioning properly",r=`Last tested: ${this.getTimeAgo(new Date(e.test_completed_at))}`,e.processing_time&&(r+=` (${e.processing_time.toFixed(2)}s)`),this.hideRetryButton(),this.hideQueueWorkerErrorDetails(),this.showQueueWorkerSuccessDetails(e);break;case"failed":t="error",s=e.message||"Queue worker test failed",r=e.error_message||"Test failed with unknown error",this.hideQueueWorkerSuccessDetails(),this.showQueueWorkerErrorDetails(e);break;case"timeout":t="timeout",s=e.message||"Queue worker test timed out",r=e.error_message||"The queue worker may not be running",this.hideQueueWorkerSuccessDetails(),this.showQueueWorkerErrorDetails(e);break;case"error":t="error",s=e.message||"Error checking queue worker status",r=e.error_message||"System error occurred",this.hideQueueWorkerSuccessDetails(),this.showQueueWorkerErrorDetails(e);break;case"testing":t="checking",s=e.message||"Testing queue worker...",r="Test in progress...",this.hideRetryButton(),this.hideQueueWorkerErrorDetails(),this.hideQueueWorkerSuccessDetails(),this.showQueueWorkerProgressDetails(e);break;default:t="not_tested",s="Click the Test Queue Worker button below",r="No recent test results available",this.hideRetryButton(),this.hideQueueWorkerErrorDetails(),this.hideQueueWorkerSuccessDetails()}this.updateStatusIndicator("queue_worker",t,s,r)}async triggerQueueWorkerTest(){if(this.queueWorkerTestInProgress){console.log("Queue worker test already in progress, skipping...");return}try{this.queueWorkerTestInProgress=!0,this.setQueueWorkerTestButtonState(!0),this.setRefreshButtonState(this.refreshInProgress),this.updateStatusIndicator("queue_worker","checking","Testing queue worker...","Dispatching test job..."),await this.performQueueWorkerTest()}catch(e){console.error("Queue worker test failed:",e);let t="Unknown error occurred";e&&typeof e=="object"?t=e.message||e.toString()||"Unknown error occurred":typeof e=="string"&&(t=e),this.updateStatusIndicator("queue_worker","error","Test failed",t)}finally{this.queueWorkerTestInProgress=!1,this.setQueueWorkerTestButtonState(!1),this.setRefreshButtonState(this.refreshInProgress)}}setQueueWorkerTestButtonState(e){const t=document.getElementById("test-queue-worker-btn"),s=document.getElementById("test-queue-worker-btn-text"),r=document.getElementById("test-queue-worker-spinner"),i=document.getElementById("retry-queue-worker-btn");t&&s&&(t.disabled=e||this.refreshInProgress,s.textContent=e?"Testing...":"Test Queue Worker",r&&(e?r.classList.remove("hidden"):r.classList.add("hidden")),t.disabled?(t.classList.add("cursor-not-allowed","opacity-75"),t.setAttribute("aria-disabled","true"),t.setAttribute("title","Please wait for current operation to complete")):(t.classList.remove("cursor-not-allowed","opacity-75"),t.removeAttribute("aria-disabled"),t.setAttribute("title","Test queue worker functionality"))),i&&(i.disabled=e||this.refreshInProgress,i.disabled?(i.classList.add("cursor-not-allowed","opacity-75"),i.setAttribute("aria-disabled","true")):(i.classList.remove("cursor-not-allowed","opacity-75"),i.removeAttribute("aria-disabled")))}async performQueueWorkerTest(){var e;try{this.updateStatusIndicator("queue_worker","checking","Testing queue worker...","Dispatching test job...");const t=await this.makeAjaxRequest("/setup/queue/test",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({delay:0,timeout:30})});if(!t.success)throw new Error(((e=t.error)==null?void 0:e.message)||t.message||"Failed to dispatch test job");if(!t.test_job_id)throw new Error("No test job ID returned from server");this.updateStatusIndicator("queue_worker","checking","Test job queued...","Waiting for queue worker to pick up job..."),await this.pollQueueTestResultWithEnhancedErrorHandling(t.test_job_id)}catch(t){console.error("Queue worker test failed:",t),this.handleQueueWorkerTestError(t)}}handleQueueWorkerTestError(e){let t="error",s="Test failed",r="Unknown error occurred";e&&typeof e=="object"?r=e.message||e.toString()||"Unknown error occurred":typeof e=="string"&&(r=e),this.isDispatchError(e)?(t="error",s="Failed to dispatch test job",r=this.getDispatchErrorDetails(e)):this.isNetworkError(e)?(t="error",s="Network error during test",r=this.getNetworkErrorDetails(e)):this.isTimeoutError(e)?(t="timeout",s="Queue worker test timed out",r=this.getTimeoutErrorDetails(e)):r=`${e.message}. Check the application logs for more details.`,this.updateStatusIndicator("queue_worker",t,s,r),this.addRetryButtonToQueueWorkerStatus()}isDispatchError(e){const t=e.message.toLowerCase();return t.includes("dispatch")||t.includes("queue connection")||t.includes("database connection")||t.includes("table")||t.includes("configuration")}isNetworkError(e){const t=e.message.toLowerCase();return t.includes("network")||t.includes("connection refused")||t.includes("timeout")||t.includes("unreachable")||t.includes("fetch")}isTimeoutError(e){const t=e.message.toLowerCase();return t.includes("timeout")||t.includes("timed out")}getDispatchErrorDetails(e){return`
            <div class="space-y-2">
                <p class="text-sm text-red-700">${e.message}</p>
                <div class="bg-red-50 p-3 rounded border border-red-200">
                    <h4 class="font-medium text-red-800 mb-2">Troubleshooting Steps:</h4>
                    <ul class="text-sm text-red-700 space-y-1 list-disc list-inside">
                        <li>Verify queue configuration in .env file (QUEUE_CONNECTION)</li>
                        <li>Check if database tables exist: php artisan migrate</li>
                        <li>Ensure queue driver is properly configured</li>
                        <li>Check application logs for configuration errors</li>
                    </ul>
                </div>
            </div>
        `}getNetworkErrorDetails(e){return`
            <div class="space-y-2">
                <p class="text-sm text-red-700">${e.message}</p>
                <div class="bg-red-50 p-3 rounded border border-red-200">
                    <h4 class="font-medium text-red-800 mb-2">Troubleshooting Steps:</h4>
                    <ul class="text-sm text-red-700 space-y-1 list-disc list-inside">
                        <li>Check your internet connection</li>
                        <li>Verify the application server is accessible</li>
                        <li>Check for firewall or proxy issues</li>
                        <li>Try refreshing the page and testing again</li>
                    </ul>
                </div>
            </div>
        `}getTimeoutErrorDetails(e){return`
            <div class="space-y-2">
                <p class="text-sm text-yellow-700">${e.message}</p>
                <div class="bg-yellow-50 p-3 rounded border border-yellow-200">
                    <h4 class="font-medium text-yellow-800 mb-2">Troubleshooting Steps:</h4>
                    <ul class="text-sm text-yellow-700 space-y-1 list-disc list-inside">
                        <li>Ensure queue worker is running: php artisan queue:work</li>
                        <li>Check if worker process is stuck or crashed</li>
                        <li>Verify queue driver configuration</li>
                        <li>Check system resources (CPU, memory, disk space)</li>
                        <li>Review worker logs for errors or warnings</li>
                    </ul>
                </div>
            </div>
        `}addRetryButtonToQueueWorkerStatus(){const e=document.getElementById("details-queue_worker-text");if(e&&!e.querySelector(".retry-queue-test-btn")){const t=document.createElement("button");t.className="retry-queue-test-btn mt-3 inline-flex items-center px-3 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-900 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition ease-in-out duration-150",t.innerHTML=`
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Retry Test
                `,t.addEventListener("click",()=>{this.retryQueueWorkerTest()}),e.appendChild(t)}}async retryQueueWorkerTest(){console.log("Retrying queue worker test..."),this.hideQueueWorkerErrorDetails(),this.hideRetryButton();const e=document.querySelector(".retry-queue-test-btn");e&&e.remove(),this.clearErrorMessages(),this.queueWorkerTestInProgress=!1,await this.testQueueWorker()}showQueueWorkerErrorDetails(e,t="general"){const s=document.getElementById("queue-test-error-details"),r=document.getElementById("queue-test-error-message"),i=document.getElementById("queue-test-troubleshooting-content");s&&r&&(r.textContent=e,i&&(i.innerHTML=this.getTroubleshootingSteps(t)),s.classList.remove("hidden"),s.classList.add("error-message"),this.showRetryButton())}hideQueueWorkerErrorDetails(){const e=document.getElementById("queue-test-error-details");e&&(e.classList.add("hidden"),e.classList.remove("error-message"))}showQueueWorkerSuccessDetails(e,t=null){const s=document.getElementById("queue-test-success-details"),r=document.getElementById("queue-test-success-message"),i=document.getElementById("queue-test-processing-time");s&&r&&(r.textContent=e,t&&i&&(i.textContent=`Processing time: ${t}s`),s.classList.remove("hidden"),s.classList.add("success-message"),this.hideRetryButton())}hideQueueWorkerSuccessDetails(){const e=document.getElementById("queue-test-success-details");e&&(e.classList.add("hidden"),e.classList.remove("success-message"))}showQueueWorkerProgress(e,t=null){const s=document.getElementById("queue-test-progress"),r=document.getElementById("queue-test-progress-text"),i=document.getElementById("queue-test-progress-details");s&&r&&(r.textContent=e,t&&i?(i.textContent=t,i.classList.remove("hidden")):i&&i.classList.add("hidden"),s.classList.remove("hidden"),s.classList.add("queue-test-progress"))}hideQueueWorkerProgress(){const e=document.getElementById("queue-test-progress");e&&(e.classList.add("hidden"),e.classList.remove("queue-test-progress"))}getTroubleshootingSteps(e){const t={dispatch_failed:["Check that your database connection is working properly","Verify that the jobs table exists (run migrations if needed)","Ensure your queue configuration in .env is correct","Check Laravel logs for detailed error information"],timeout:["Verify that a queue worker is running (php artisan queue:work)","Check if the worker process is stuck or crashed","Restart the queue worker process","Check system resources (CPU, memory) on your server","Review worker logs for any error messages"],job_failed:["Check Laravel logs for the specific job failure reason","Verify file permissions in storage directories","Ensure all required dependencies are installed","Check if there are any configuration issues","Try running the queue worker with --tries=1 for debugging"],network_error:["Check your internet connection","Verify that the application server is running","Check for any firewall or proxy issues","Try refreshing the page and testing again"],general:["Check Laravel logs in storage/logs/laravel.log","Verify that the queue worker is running","Ensure database connection is working","Check system resources and server status","Try running: php artisan queue:work --tries=1"]};return(t[e]||t.general).map(r=>`<div class="troubleshooting-step">â€¢ ${r}</div>`).join("")}async pollQueueTestResultWithEnhancedErrorHandling(e){let r=0,i=0;const o=Date.now(),n=async()=>{var l;r++;try{const a=await this.makeAjaxRequest(`/setup/queue/test/status?test_job_id=${e}`,{method:"GET",headers:{"X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"}});if(i=0,!a.success||!a.status)throw new Error(((l=a.error)==null?void 0:l.message)||"Invalid response from server");const u=a.status,c=((Date.now()-o)/1e3).toFixed(1);switch(u.status){case"completed":this.updateStatusIndicator("queue_worker","completed","Queue worker is functioning properly",`Test completed successfully in ${(u.processing_time||0).toFixed(2)}s (total: ${c}s)`);return;case"failed":const g=u.error_message||"Test job failed without specific error";this.updateStatusIndicator("queue_worker","error","Test job execution failed",this.getJobFailureDetails(g,c)),this.addRetryButtonToQueueWorkerStatus();return;case"timeout":this.updateStatusIndicator("queue_worker","timeout","Queue worker test timed out",this.getTimeoutErrorDetails({message:`Test timed out after ${c}s. The queue worker may not be running.`})),this.addRetryButtonToQueueWorkerStatus();return;case"processing":this.updateStatusIndicator("queue_worker","checking","Test job processing...",`Job is being processed by queue worker (${c}s elapsed)`);break;case"pending":this.updateStatusIndicator("queue_worker","checking","Test job queued...",`Waiting for queue worker to pick up job (${c}s elapsed)`);break;default:this.updateStatusIndicator("queue_worker","checking","Testing queue worker...",`Checking test job status (${c}s elapsed)`);break}(u.status==="processing"||u.status==="pending")&&(r<30?setTimeout(n,1e3):(this.updateStatusIndicator("queue_worker","timeout","Queue worker test timed out",this.getTimeoutErrorDetails({message:`Test timed out after ${c}s. The queue worker may not be running.`})),this.addRetryButtonToQueueWorkerStatus()))}catch(a){if(console.error("Polling error:",a),this.isNetworkError(a)&&i<3){i++,console.log(`Network error during polling, retrying... (${i}/3)`);const c=((Date.now()-o)/1e3).toFixed(1);this.updateStatusIndicator("queue_worker","checking","Network error, retrying...",`Connection issue during status check (${c}s elapsed, retry ${i}/3)`),setTimeout(n,2e3);return}const u=((Date.now()-o)/1e3).toFixed(1);this.updateStatusIndicator("queue_worker","error","Error checking test status",this.getPollingErrorDetails(a,u)),this.addRetryButtonToQueueWorkerStatus()}};n()}getJobFailureDetails(e,t){return`
            <div class="space-y-2">
                <p class="text-sm text-red-700">Job failed after ${t}s: ${e}</p>
                <div class="bg-red-50 p-3 rounded border border-red-200">
                    <h4 class="font-medium text-red-800 mb-2">Troubleshooting Steps:</h4>
                    <ul class="text-sm text-red-700 space-y-1 list-disc list-inside">
                        <li>Check failed jobs table: php artisan queue:failed</li>
                        <li>Review worker logs for specific error details</li>
                        <li>Ensure all required dependencies are installed</li>
                        <li>Check memory limits and execution time settings</li>
                        <li>Verify database connectivity from worker process</li>
                    </ul>
                </div>
            </div>
        `}getPollingErrorDetails(e,t){return`
            <div class="space-y-2">
                <p class="text-sm text-red-700">Status check failed after ${t}s: ${e.message}</p>
                <div class="bg-red-50 p-3 rounded border border-red-200">
                    <h4 class="font-medium text-red-800 mb-2">Troubleshooting Steps:</h4>
                    <ul class="text-sm text-red-700 space-y-1 list-disc list-inside">
                        <li>Check your internet connection</li>
                        <li>Verify the application server is accessible</li>
                        <li>Try refreshing the page and testing again</li>
                        <li>Check application logs for server errors</li>
                    </ul>
                </div>
            </div>
        `}async pollQueueTestResultForStatus(e){let s=0;const r=async()=>{s++;try{const i=await this.makeAjaxRequest(`/setup/queue/test/status?test_job_id=${e}`,{method:"GET",headers:{"X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"}});if(!i.success||!i.status)throw new Error("Invalid response from server");const o=i.status;switch(o.status){case"completed":this.updateStatusIndicator("queue_worker","completed",`Queue worker is functioning properly (${(o.processing_time||0).toFixed(2)}s)`,`Test completed successfully at ${new Date().toLocaleTimeString()}`);return;case"failed":this.updateStatusIndicator("queue_worker","error","Queue worker test failed",o.error_message||"Test job failed with unknown error");return;case"timeout":this.updateStatusIndicator("queue_worker","error","Queue worker test timed out","The queue worker may not be running");return;case"processing":this.updateStatusIndicator("queue_worker","checking","Test job processing...",`Job is being processed by worker (${s}s elapsed)`);break;case"pending":this.updateStatusIndicator("queue_worker","checking","Test job queued...",`Waiting for queue worker to pick up job (${s}s elapsed)`);break;default:this.updateStatusIndicator("queue_worker","checking","Testing queue worker...",`Checking test job status (${s}s elapsed)`);break}(o.status==="processing"||o.status==="pending")&&(s<30?setTimeout(r,1e3):this.updateStatusIndicator("queue_worker","timeout","Queue worker test timed out (30s)","The queue worker may not be running. Check if 'php artisan queue:work' is active."))}catch(i){console.error("Polling error:",i),this.updateStatusIndicator("queue_worker","error","Error checking test status",i.message||"Unknown error")}};r()}async testQueueWorker(){try{await this.triggerQueueWorkerTest()}catch(e){console.error("Queue worker test failed:",e)}}async pollQueueTestResultWithProgressiveUpdates(e,t){let r=0;const i=Date.now(),o=async()=>{r++;try{const n=await this.makeAjaxRequest(`/setup/queue/test/status?test_job_id=${e}`,{method:"GET",headers:{"X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"}});if(n.success&&n.status){const l=n.status,a=((Date.now()-i)/1e3).toFixed(1);switch(l.status){case"completed":this.hideQueueWorkerProgress();const u=(l.processing_time||0).toFixed(2);this.showQueueWorkerSuccessDetails(`Queue worker is functioning properly! Job completed in ${u}s (total test time: ${a}s)`,u),this.updateStatusIndicator("queue_worker","completed","Queue worker is functioning properly",`Last tested: just now (${u}s)`),t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="h-4 w-4 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-green-700">Queue worker is functioning properly! Job completed in ${u}s (total test time: ${a}s)</span>
                                </div>
                            `;return;case"failed":this.hideQueueWorkerProgress();const c=l.error_message||"Unknown error";this.showQueueWorkerErrorDetails(c,"job_failed"),this.updateStatusIndicator("queue_worker","failed","Queue worker test failed",`Test failed: ${c}`),t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="h-4 w-4 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-red-700">Queue test failed: ${c} (after ${a}s)</span>
                                </div>
                            `;return;case"timeout":this.hideQueueWorkerProgress(),this.showQueueWorkerErrorDetails(`Test timed out after ${a}s. The queue worker may not be running.`,"timeout"),this.updateStatusIndicator("queue_worker","timeout","Queue worker test timed out","The queue worker may not be running"),t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="h-4 w-4 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-yellow-700">Test timed out after ${a}s. The queue worker may not be running.</span>
                                </div>
                            `;return;case"processing":this.showQueueWorkerProgress("Test job is being processed...",`${a}s elapsed`),t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="animate-spin h-4 w-4 text-blue-600 mr-2" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 818-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span class="text-blue-700">Test job is being processed... (${a}s elapsed)</span>
                                </div>
                            `;break;case"pending":this.showQueueWorkerProgress("Test job is queued, waiting for worker...",`${a}s elapsed`),t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="animate-pulse h-4 w-4 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-yellow-700">Test job is queued, waiting for worker... (${a}s elapsed)</span>
                                </div>
                            `;break;default:t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="animate-spin h-4 w-4 text-blue-600 mr-2" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 818-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span class="text-blue-700">Testing queue worker... (${a}s elapsed)</span>
                                </div>
                            `;break}(l.status==="processing"||l.status==="pending")&&(r<30?setTimeout(o,1e3):t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="h-4 w-4 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-yellow-700">Test timed out after ${a}s. The queue worker may not be running.</span>
                                </div>
                            `)}else throw new Error("Invalid response from server")}catch(n){console.error("Polling error:",n);const l=((Date.now()-i)/1e3).toFixed(1);t.innerHTML=`
                    <div class="flex items-center">
                        <svg class="h-4 w-4 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-red-700">Error checking test status: ${n.message} (after ${l}s)</span>
                    </div>
                `}};o()}async pollQueueTestResult(e,t){let r=0;const i=async()=>{r++;try{const o=await this.makeAjaxRequest(`/setup/queue/test/status?test_job_id=${e}`,{method:"GET",headers:{"X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"}});if(o.success&&o.status){const n=o.status;switch(n.status){case"completed":t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="h-4 w-4 text-green-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-green-700">Queue worker is functioning properly! Job completed in ${(n.processing_time||0).toFixed(2)}s</span>
                                </div>
                            `;return;case"failed":t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="h-4 w-4 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-red-700">Queue test failed: ${n.error_message||"Unknown error"}</span>
                                </div>
                            `;return;case"processing":t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="animate-spin h-4 w-4 text-blue-600 mr-2" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 818-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                    <span class="text-blue-700">Test job is being processed... (${r}s)</span>
                                </div>
                            `;break;case"pending":t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="animate-pulse h-4 w-4 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-yellow-700">Test job is queued, waiting for worker... (${r}s)</span>
                                </div>
                            `;break}(n.status==="processing"||n.status==="pending")&&(r<30?setTimeout(i,1e3):t.innerHTML=`
                                <div class="flex items-center">
                                    <svg class="h-4 w-4 text-yellow-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    <span class="text-yellow-700">Test timed out after 30 seconds. The queue worker may not be running.</span>
                                </div>
                            `)}else throw new Error("Invalid response from server")}catch(o){console.error("Polling error:",o),t.innerHTML=`
                    <div class="flex items-center">
                        <svg class="h-4 w-4 text-red-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-red-700">Error checking test status: ${o.message}</span>
                    </div>
                `}};i()}updateLastChecked(){const e=document.getElementById("last-checked"),t=document.getElementById("last-checked-time");if(e&&t){const s=new Date;t.textContent=s.toLocaleTimeString(),e.classList.remove("hidden")}}resetRetryAttempts(){this.retryAttempts=0}retryRefresh(){this.resetRetryAttempts(),this.clearMessages(),this.refreshAllStatuses()}toggleAutoRefresh(e){this.autoRefreshEnabled=e,e?this.autoRefreshInterval=setInterval(()=>{this.refreshInProgress||this.refreshAllStatuses()},3e4):this.autoRefreshInterval&&(clearInterval(this.autoRefreshInterval),this.autoRefreshInterval=null)}updateStatusDetails(e,t,s){const r=document.getElementById(`details-${e}-text`);if(!r)return;let i="";if(typeof s=="object"&&s!==null){let o=s;if(typeof s=="string")try{o=JSON.parse(s)}catch{i=`<div>${s}</div>`,r.innerHTML=i;return}if(o.checked_at){const n=new Date(o.checked_at),l=this.getTimeAgo(n);i+=`<div class="mb-2"><strong>Last checked:</strong> ${l}</div>`}i+=this.getStatusSpecificDetails(e,t,o),(t==="incomplete"||t==="error"||t==="cannot_verify")&&(i+=this.getTroubleshootingGuidance(e,t,o))}else if(typeof s=="string")try{const o=JSON.parse(s);this.updateStatusDetails(e,t,o);return}catch{i=`<div>${s}</div>`}else i=`<div>${String(s||"No additional details available.")}</div>`;r.innerHTML=i||"No additional details available."}getStatusSpecificDetails(e,t,s){let r="";switch(e){case"queue_worker":s.recent_jobs!==void 0&&(r+=`<div class="mb-2">
                        <strong>Queue Statistics:</strong>
                        <ul class="ml-4 mt-1 text-sm">
                            <li>Recent jobs (24h): ${s.recent_jobs}</li>
                            <li>Recent failed jobs: ${s.recent_failed_jobs||0}</li>
                            <li>Total failed jobs: ${s.total_failed_jobs||0}</li>
                            <li>Stalled jobs: ${s.stalled_jobs||0}</li>
                        </ul>
                    </div>`);break;case"database":s.scenario?r+=this.getDatabaseStatusDetails(t,s):s.connection_name&&(r+=`<div class="mb-2"><strong>Connection:</strong> ${s.connection_name}</div>`);break;case"mail":s.driver&&(r+=`<div class="mb-2"><strong>Mail driver:</strong> ${s.driver}</div>`);break;case"cloud_storage":if(s.google_drive){const i=s.google_drive.configured;r+=`<div class="mb-3 p-3 ${i?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"} rounded">
                        <div class="flex items-center mb-2">
                            <span class="text-lg mr-2">${i?"âœ…":"âšª"}</span>
                            <strong class="${i?"text-green-800":"text-gray-700"}">Google Drive</strong>
                            ${i?'<span class="ml-2 text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">Configured</span>':""}
                        </div>
                        <ul class="ml-6 text-sm ${i?"text-green-700":"text-gray-600"}">
                            <li>Client ID: ${s.google_drive.client_id}</li>
                            <li>Client Secret: ${s.google_drive.client_secret}</li>
                        </ul>
                    </div>`}if(s.s3){const i=s.s3.configured;r+=`<div class="mb-2 p-3 ${i?"bg-green-50 border border-green-200":"bg-gray-50 border border-gray-200"} rounded">
                        <div class="flex items-center mb-2">
                            <span class="text-lg mr-2">${i?"âœ…":"âšª"}</span>
                            <strong class="${i?"text-green-800":"text-gray-700"}">Amazon S3</strong>
                            ${i?'<span class="ml-2 text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded">Configured</span>':""}
                        </div>
                        <ul class="ml-6 text-sm ${i?"text-green-700":"text-gray-600"}">
                            <li>Access Key ID: ${s.s3.access_key_id}</li>
                            <li>Secret Access Key: ${s.s3.secret_access_key}</li>
                            <li>Region: ${s.s3.region}</li>
                            <li>Bucket: ${s.s3.bucket}</li>
                        </ul>
                    </div>`}break}return s.error&&(r+=`<div class="mb-2 p-2 bg-red-50 border border-red-200 rounded">
                <strong>Error:</strong> ${s.error}
            </div>`),r}getDatabaseStatusDetails(e,t){const s=t.scenario;let r="";switch(s){case"no_credentials":r+=`
                    <div class="mb-3 p-3 bg-red-50 border border-red-200 rounded">
                        <div class="flex items-start">
                            <span class="text-red-600 text-lg mr-2">âŒ</span>
                            <div>
                                <h4 class="text-sm font-medium text-red-800">No Database Credentials</h4>
                                <p class="mt-1 text-sm text-red-700">${t.description}</p>
                                <div class="mt-2">
                                    <p class="text-sm font-medium text-red-800">Missing fields:</p>
                                    <ul class="mt-1 text-sm text-red-700 list-disc list-inside">
                                        ${t.metadata.missing_fields.map(i=>`<li>${i}</li>`).join("")}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;break;case"partial_credentials":r+=`
                    <div class="mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded">
                        <div class="flex items-start">
                            <span class="text-yellow-600 text-lg mr-2">âš ï¸</span>
                            <div>
                                <h4 class="text-sm font-medium text-yellow-800">Partial Database Configuration</h4>
                                <p class="mt-1 text-sm text-yellow-700">${t.description}</p>
                                <div class="mt-2 grid grid-cols-1 gap-2">
                                    <div>
                                        <p class="text-sm font-medium text-yellow-800">Missing fields:</p>
                                        <ul class="mt-1 text-sm text-yellow-700 list-disc list-inside">
                                            ${t.metadata.missing_fields.map(i=>`<li>${i}</li>`).join("")}
                                        </ul>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-yellow-800">Configured fields:</p>
                                        <ul class="mt-1 text-sm text-yellow-700 list-disc list-inside">
                                            ${t.metadata.configured_fields.map(i=>`<li>${i}</li>`).join("")}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;break;case"connection_failed":r+=`
                    <div class="mb-3 p-3 bg-red-50 border border-red-200 rounded">
                        <div class="flex items-start">
                            <span class="text-red-600 text-lg mr-2">ðŸš«</span>
                            <div>
                                <h4 class="text-sm font-medium text-red-800">Database Connection Failed</h4>
                                <p class="mt-1 text-sm text-red-700">${t.description}</p>
                                <div class="mt-2">
                                    <p class="text-sm font-medium text-red-800">Connection details:</p>
                                    <ul class="mt-1 text-sm text-red-700 space-y-1">
                                        <li><strong>Type:</strong> ${t.metadata.connection_type}</li>
                                        <li><strong>Host:</strong> ${t.metadata.host}</li>
                                        <li><strong>Database:</strong> ${t.metadata.database}</li>
                                        <li><strong>Username:</strong> ${t.metadata.username}</li>
                                    </ul>
                                    ${t.metadata.error_message?`
                                        <div class="mt-2 p-2 bg-red-100 rounded text-xs text-red-800">
                                            <strong>Error:</strong> ${t.metadata.error_message}
                                        </div>
                                    `:""}
                                </div>
                            </div>
                        </div>
                    </div>
                `;break;case"connection_successful":r+=`
                    <div class="mb-3 p-3 bg-green-50 border border-green-200 rounded">
                        <div class="flex items-start">
                            <span class="text-green-600 text-lg mr-2">âœ…</span>
                            <div>
                                <h4 class="text-sm font-medium text-green-800">Database Connection Successful</h4>
                                <p class="mt-1 text-sm text-green-700">${t.description}</p>
                                <div class="mt-2">
                                    <p class="text-sm font-medium text-green-800">Connection details:</p>
                                    <ul class="mt-1 text-sm text-green-700 space-y-1">
                                        <li><strong>Type:</strong> ${t.metadata.connection_type}</li>
                                        <li><strong>Host:</strong> ${t.metadata.host}</li>
                                        <li><strong>Database:</strong> ${t.metadata.database}</li>
                                        <li><strong>Username:</strong> ${t.metadata.username}</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;break;default:r+=`<div class="mb-2"><strong>Status:</strong> ${t.description||"Database status information available"}</div>`}return r}getTroubleshootingGuidance(e,t,s){let r='<div class="mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded">';switch(t==="cannot_verify"?(r+="<strong>Cannot Verify - Manual Check Required:</strong>",r+='<p class="text-sm mt-1 mb-2">The system cannot automatically verify this step. Please check manually:</p>'):r+="<strong>Troubleshooting:</strong>",r+='<ul class="ml-4 mt-2 text-sm">',e){case"database":t==="cannot_verify"?(r+="<li>Check your database connection settings in .env file</li>",r+="<li>Ensure your database server is running</li>",r+="<li>Verify database credentials are correct</li>",r+="<li><strong>Manual verification:</strong> Try running <code>php artisan migrate:status</code></li>"):t==="incomplete"&&(r+="<li>Run database migrations: <code>php artisan migrate</code></li>",r+="<li>Check if all required tables exist</li>");break;case"mail":t==="cannot_verify"&&(r+="<li>Check mail configuration in .env file</li>",r+="<li>For local development, consider using log driver</li>",r+="<li>Verify SMTP credentials if using external mail service</li>",r+="<li><strong>Manual verification:</strong> Try sending a test email or check logs</li>");break;case"cloud_storage":t==="incomplete"&&(r+="<li><strong>Option 1: Google Drive</strong></li>",r+="<li class='ml-4'>Set GOOGLE_DRIVE_CLIENT_ID in .env file</li>",r+="<li class='ml-4'>Set GOOGLE_DRIVE_CLIENT_SECRET in .env file</li>",r+="<li class='ml-4'>Complete OAuth setup in Google Cloud Console</li>",r+="<li class='mt-2'><strong>Option 2: Amazon S3</strong></li>",r+="<li class='ml-4'>Set AWS_ACCESS_KEY_ID in .env file</li>",r+="<li class='ml-4'>Set AWS_SECRET_ACCESS_KEY in .env file</li>",r+="<li class='ml-4'>Set AWS_DEFAULT_REGION in .env file</li>",r+="<li class='ml-4'>Set AWS_BUCKET in .env file</li>");break;case"queue_worker":t==="cannot_verify"?(r+="<li>Start queue worker: <code>php artisan queue:work</code></li>",r+="<li>Check if queue tables exist in database</li>",r+="<li><strong>Manual verification:</strong> Use the test button above to verify functionality</li>",r+="<li>Check queue status with: <code>php artisan queue:monitor</code></li>"):t==="needs_attention"&&(r+="<li>Check failed jobs: <code>php artisan queue:failed</code></li>",r+="<li>Restart queue worker if needed</li>",r+="<li>Review application logs for errors</li>");break;case"admin_user":t==="incomplete"&&(r+="<li>Create admin user: <code>php artisan make:admin</code></li>",r+="<li>Or register through the web interface</li>");break;case"migrations":t==="incomplete"&&(r+="<li>Run migrations: <code>php artisan migrate</code></li>",r+="<li>Check database connection first</li>");break}return r+="</ul></div>",r}getTimeAgo(e){const s=new Date-e,r=Math.floor(s/1e3),i=Math.floor(r/60),o=Math.floor(i/60);return r<60?"Just now":i<60?`${i} minute${i!==1?"s":""} ago`:o<24?`${o} hour${o!==1?"s":""} ago`:e.toLocaleString()}toggleStatusDetails(e){const t=document.getElementById(`details-${e}`);t&&t.classList.toggle("show")}debouncedTestEmail(e){e.preventDefault();const t=Date.now(),s=t-this.lastEmailTestTime;if(this.emailTestInProgress){console.log("Email test already in progress, ignoring click");return}if(s<this.debounceDelay){console.log("Debouncing email test request"),this.clickTimeouts.has("emailTest")&&clearTimeout(this.clickTimeouts.get("emailTest"));const r=setTimeout(()=>{this.testEmail(),this.clickTimeouts.delete("emailTest")},this.debounceDelay-s);this.clickTimeouts.set("emailTest",r);return}this.lastEmailTestTime=t,this.testEmail()}async testEmail(){const e=document.getElementById("test-email-address"),t=document.getElementById("test-email-btn"),s=document.getElementById("test-email-btn-text"),r=document.getElementById("test-email-spinner"),i=document.getElementById("email-test-results"),o=document.getElementById("email-test-success"),n=document.getElementById("email-test-error");if(!e){console.error("Email input not found");return}const l=e.value.trim();if(!l){this.showEmailTestError("Please enter an email address.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(l)){this.showEmailTestError("Please enter a valid email address.");return}try{this.emailTestInProgress=!0,t&&(t.disabled=!0),s&&(s.textContent="Sending..."),r&&r.classList.remove("hidden"),e&&(e.disabled=!0),i&&i.classList.add("hidden"),o&&o.classList.add("hidden"),n&&n.classList.add("hidden");const u=await this.makeAjaxRequest("/setup/email/test",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":this.getCSRFToken(),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({email:l})});if(u.success)this.showEmailTestSuccess(`Test email sent to ${l}. Please check your inbox to confirm delivery.`);else{const c=u.error||{};this.showEmailTestError(c.message||"Failed to send test email.",c.troubleshooting||[])}}catch(u){console.error("Email test failed:",u),u.message&&u.message.includes("429")?this.showEmailTestError("Too many test email attempts. Please wait a few minutes before trying again."):this.showEmailTestError(u.message||"An unexpected error occurred while sending the test email.")}finally{this.emailTestInProgress=!1,t&&(t.disabled=!1),s&&(s.textContent="Send Test Email"),r&&r.classList.add("hidden"),e&&(e.disabled=!1)}}showEmailTestSuccess(e){const t=document.getElementById("email-test-results"),s=document.getElementById("email-test-success"),r=document.getElementById("email-test-success-message"),i=document.getElementById("email-test-error");t&&t.classList.remove("hidden"),i&&i.classList.add("hidden"),s&&s.classList.remove("hidden"),r&&(r.textContent=e)}showEmailTestError(e,t=[]){const s=document.getElementById("email-test-results"),r=document.getElementById("email-test-success"),i=document.getElementById("email-test-error"),o=document.getElementById("email-test-error-message"),n=document.getElementById("email-test-troubleshooting"),l=document.getElementById("email-test-troubleshooting-list");s&&s.classList.remove("hidden"),r&&r.classList.add("hidden"),i&&i.classList.remove("hidden"),o&&(o.textContent=e),n&&l&&(t&&t.length>0?(l.textContent="",t.forEach(a=>{const u=document.createElement("li");u.textContent=a,l.appendChild(u)}),n.classList.remove("hidden")):n.classList.add("hidden"))}cleanup(){this.autoRefreshInterval&&clearInterval(this.autoRefreshInterval)}}function k(d){window.setupStatusManager?window.setupStatusManager.toggleStatusDetails(d):console.error("SetupStatusManager not initialized yet")}window.toggleStatusDetails=k;window.SetupStatusManager=m;document.addEventListener("DOMContentLoaded",function(){console.log("SetupStatusManager: DOM loaded, initializing..."),window.setupStatusManager=new m,console.log("SetupStatusManager: Instance created"),window.addEventListener("beforeunload",()=>{window.setupStatusManager&&window.setupStatusManager.cleanup()})});typeof h<"u"&&h.exports&&(h.exports=m)});export default y();
